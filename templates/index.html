<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RiceCare - Phát Hiện Bệnh Lá Lúa</title>
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            rice: {
              50: '#f0fdf4',
              100: '#dcfce7',
              500: '#22c55e',
              600: '#16a34a',
              700: '#15803d',
              800: '#166534',
              900: '#14532d',
            }
          }
        }
      }
    }
  </script>
  
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" rel="stylesheet">
  <style>
    .upload-area { transition: all 0.3s ease; }
    .upload-area:hover { transform: scale(1.02); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }
  </style>
</head>

<body class="bg-gradient-to-br from-rice-50 via-green-50 to-emerald-100 min-h-screen">
  <div class="container mx-auto px-4 py-8 max-w-6xl">
    
    <!-- Header + Logo – HOẠT ĐỘNG 100% -->
<header class="text-center mb-12">
  <!-- Logo của bạn – đường dẫn chuẩn FastAPI -->
  <img src="/static/Logo_Marie_Curie.png" 
       alt="Logo Marie Curie" 
       class="h-36 w-36 mx-auto mb-7 rounded-full shadow-2xl border-4 border-rice-600 object-cover ring-8 ring-white/60
              transition-transform hover:scale-105"
       onerror="this.onerror=null; this.src='/static/Logo_Marie_Curie.png';">
  
  <!-- Dự phòng: nếu vẫn không load được thì hiện ảnh placeholder đẹp -->
  <div class="hidden" id="fallback-logo">
    <div class="h-36 w-36 mx-auto mb-7 rounded-full bg-rice-600 flex items-center justify Arboretum justify-center text-white text-5xl font-bold shadow-2xl border-4 border-rice-700">
      MC
    </div>
  </div>

  <h1 class="text-5xl md:text-6xl font-bold text-rice-800 mb-3 tracking-tight">
    RiceCare
  </h1>
  <p class="text-2xl text-rice-700 font-medium">
    Hệ thống phát hiện bệnh lá lúa bằng AI
  </p>
  <p class="text-lg text-green-700 mt-4 max-w-2xl mx-auto">
    Upload ảnh lá lúa → Nhận kết quả chính xác trong 1 giây!
  </p>
</header>

    <!-- Upload Area -->
    <div class="max-w-3xl mx-auto">
      <div id="uploadArea" 
           class="upload-area bg-white/95 backdrop-blur-sm rounded-3xl shadow-2xl border-4 border-dashed border-rice-500 p-16 text-center cursor-pointer hover:border-rice-600 transition-all duration-300">
        <i class="fas fa-cloud-upload-alt text-8xl text-rice-600 mb-6"></i>
        <p class="text-3xl font-bold text-rice-800">Kéo & thả ảnh vào đây</p>
        <p class="text-xl text-rice-600 mt-3">hoặc click để chọn file</p>
        <input type="file" id="fileInput" accept="image/*" class="hidden">
      </div>

      <!-- Loading -->
      <div id="loading" class="hidden text-center mt-12">
        <i class="fas fa-spinner fa-spin text-7xl text-rice-600"></i>
        <p class="text-2xl text-rice-700 mt-6 font-medium">Đang phân tích bệnh lá lúa...</p>
      </div>

      <!-- Result -->
      <div id="result" class="mt-12 hidden">
        <h2 class="text-4xl font-bold text-center text-rice-800 mb-10 flex items-center justify-center gap-3">
          <i class="fas fa-check-circle text-rice-600"></i> Kết quả phân tích
        </h2>

        <div class="grid md:grid-cols-2 gap-10 items-start">
          <!-- Ảnh kết quả -->
          <div class="bg-white rounded-3xl shadow-2xl overflow-hidden border border-gray-200">
            <img id="resultImage" class="w-full" alt="Ảnh lá lúa đã được đánh dấu bệnh">
          </div>

          <!-- Danh sách bệnh -->
          <div id="diseaseList" class="space-y-6">
            <!-- JS sẽ tự động thêm vào đây -->
          </div>
        </div>

        <div class="text-center mt-12">
          <button onclick="document.getElementById('result').classList.add('hidden'); 
                           document.getElementById('uploadArea').scrollIntoView({behavior:'smooth'})"
                  class="bg-rice-600 hover:bg-rice-700 text-white font-bold py-4 px-12 rounded-full text-xl shadow-xl transition transform hover:scale-105">
            Chụp ảnh mới
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer - Đã làm gọn + đẹp hơn -->
  <footer class="mt-24 pb-10 text-center">
    <div class="border-t border-rice-200 pt-8 max-w-4xl mx-auto">
      <p class="text-rice-700 font-medium mb-2">Liên hệ:</p>
      <p class="text-sm text-rice-600 leading-relaxed">
        Công ty TNHH MTV Minh Trí và những người bạn Marie Curie<br>
        159 Nam Kỳ Khởi Nghĩa, Phường Xuân Hòa, TP. Hồ Chí Minh<br>
        Lại Nguyễn Minh Trí - 
        <a href="mailto:laingminhtri@gmail.com" class="text-rice-600 hover:text-rice-800 underline font-medium">
          laingminhtri@gmail.com
        </a>
      </p>
      <p class="text-xs text-rice-500 mt-6">© 2025 MCTeam - Phát hiện bệnh lá lúa bằng YOLOv8</p>
    </div>
  </footer>

  <script>
    const fileInput = document.getElementById('fileInput');
    const uploadArea = document.getElementById('uploadArea');
    const loading = document.getElementById('loading');
    const result = document.getElementById('result');

    uploadArea.onclick = () => fileInput.click();

    fileInput.onchange = async () => {
      const file = fileInput.files[0];
      if (!file) return;

      loading.classList.remove('hidden');
      result.classList.add('hidden');
      
      const form = new FormData();
      form.append('file', file);

      try {
        const res = await fetch('/predict', { method: 'POST', body: form });
        const data = await res.json();

        document.getElementById('resultImage').src = 'data:image/jpeg;base64,' + data.image;

        const list = document.getElementById('diseaseList');
        list.innerHTML = '';
        
        if (data.diseases.length === 0) {
          list.innerHTML = `
            <div class="bg-gradient-to-r from-green-50 to-emerald-50 border-l-8 border-green-600 p-10 rounded-3xl shadow-xl text-center">
              <p class="text-4xl font-bold text-green-800 mb-3">LÁ LÚA KHỎE MẠNH!</p>
              <p class="text-xl text-green-700">Không phát hiện bệnh nào</p>
  <p class="text-5xl mt-4">Healthy</p>
            </div>`;
        } else {
          data.diseases.forEach(d => {
            const isHealthy = d.disease.includes('Khỏe') || d.disease.includes('Bình thường');
            const colorClass = isHealthy ? 'green' : 'red';
            list.innerHTML += `
              <div class="bg-white p-8 rounded-3xl shadow-xl border-l-8 border-${colorClass}-600 transform hover:scale-105 transition-all duration-300">
                <p class="text-2xl font-bold text-${colorClass}-800 mb-4">${d.disease}</p>
                <div class="w-full bg-gray-200 rounded-full h-10 relative overflow-hidden">
                  <div class="bg-${colorClass}-600 h-full flex items-center justify-center text-white font-bold text-lg"
                       style="width: ${d.confidence*100}%">
                    ${(d.confidence*100).toFixed(1)}%
                  </div>
                </div>
              </div>`;
          });
        }

        loading.classList.add('hidden');
        result.classList.remove('hidden');
        result.scrollIntoView({behavior: 'smooth'});

      } catch (err) {
        alert("Lỗi kết nối server. Vui lòng thử lại!");
        loading.classList.add('hidden');
      }
    };
  </script>
</body>
</html>
